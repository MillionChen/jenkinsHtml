(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{1338:function(e,t,a){var n=a(12),r=a(1360).values;n({target:"Object",stat:!0},{values:function(e){return r(e)}})},1360:function(e,t,a){var n=a(19),r=a(90),l=a(38),o=a(116).f,u=function(e){return function(t){for(var a,u=l(t),i=r(u),s=i.length,c=0,f=[];s>c;)a=i[c++],n&&!o.call(u,a)||f.push(e?[a,u[a]]:u[a]);return f}};e.exports={entries:u(!0),values:u(!1)}},1475:function(e,t,a){"use strict";var n=a(4),r=a(0);a(7),a(44),a(3),a(5),a(43),a(107),a(51),a(9),a(10),a(8),a(20),a(34),a(23),a(6),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a(99);var l=r(a(100));a(537);var o=r(a(536));a(61);var u=r(a(62)),i=r(a(79)),s=r(a(238));a(239);var c=r(a(240)),f=r(a(29)),d=r(a(30)),p=r(a(59)),m=r(a(32)),y=r(a(33)),g=r(a(31)),h=r(a(2));a(554);var v=r(a(550));a(540);var S=r(a(539)),O=n(a(1)),w=a(52),b=n(a(1337));function E(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function C(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?E(Object(a),!0).forEach((function(t){(0,h.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):E(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function k(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var R=S.default.Item,V=v.default.Option,D=0,x=function(e){(0,m.default)(n,e);var t,a=(t=n,function(){var e,a=(0,g.default)(t);if(k()){var n=(0,g.default)(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return(0,y.default)(this,e)});function n(e){var t;return(0,f.default)(this,n),t=a.call(this,e),(0,h.default)((0,p.default)(t),"queryData",(0,c.default)(s.default.mark((function e(){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.props.rulesGetInitJson((function(e){if(1e3==e.code&&e.data){var a=t.state,n=a.defaultArray,r=a.userList,l=Object.keys(e.data.property.user),o=Object.keys(e.data.relation);n={property:l[0],relation:o[0]},r=e.data.property.user;var u=t.props.cacheList,i=void 0===u?[]:u,s=t.state.optionData;if(i.length){for(var c=[],f=t.props.form,d=f.getFieldValue("keys"),p=0;p<i.length;p++)c.push(i[p]),s.push({pageNo:1,list:[]}),0!=p&&d.push(D++);t.setState({relationList:e.data.relation,formSelect:c,defaultArray:n,userList:r,optionData:s});var m=d;f.setFieldsValue({keys:m})}else t.setState({relationList:e.data.relation,formSelect:[C({andOr:"and"},n)],defaultArray:n,userList:r})}}));case 1:case"end":return e.stop()}}),e)})))),(0,h.default)((0,p.default)(t),"onOrAndChange",(function(e,a){var n=t.state.formSelect;n.filter((function(e,t){return 0!=t})).map((function(t){t.andOr=e})),t.setState({formSelect:n,slevalue:e})})),(0,h.default)((0,p.default)(t),"onSecondChange",(function(e,a){var n=t.state.formSelect;"org"===e&&(n[a].relation="equals"),n[a].property=e,t.setState({formSelect:n})})),(0,h.default)((0,p.default)(t),"onThirdChange",(function(e,a){var n=t.state.formSelect;n[a].relation=e,n[a].value="",n[a].name="",t.setState({formSelect:n})})),(0,h.default)((0,p.default)(t),"onLastChange",(function(e,a,n,r){var l=t.state.formSelect;if("sel"==n){var o=r.props.attr;l[a].value=o,l[a].name=r.props.children}else l[a].value=e.target.value,l[a].name="";t.setState({formSelect:l})})),(0,h.default)((0,p.default)(t),"handleLastSearch",(function(e,a){var n=t.state.optionData;n[a]={pageNo:1,list:[]},t.setState({optionData:n,optionVal:e},(function(){t.changeOptionsData(a,e)}))})),(0,h.default)((0,p.default)(t),"changePopupScroll",(function(e,a){var n=t.state.optionData;n[a].pages&&n[a].pageNo==n[a].pages||e.target.scrollTop>=e.target.scrollHeight-e.target.offsetHeight-10&&(n[a].pageNo=n[a].pageNo+1,t.setState({optionData:n},(function(){t.changeOptionsData(a)})))})),(0,h.default)((0,p.default)(t),"handleFocus",(function(e,a){var n=t.state.formSelect,r=t.state.optionData;r[a]={pageNo:1,list:[]},console.log(n[a].value,"=====formSelect[index]"),t.setState({optionVal:"",optionData:r}),t.changeOptionsData(a)})),(0,h.default)((0,p.default)(t),"changeOptionsData",(function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var a=(0,p.default)(t),n=t.state.formSelect,r=t.state.optionData;t.props.recommendStrategyDrools({pageNo:a.state.optionData[e].pageNo,pageSize:a.state.pageSize,taskParamsType:n[e].property,taskParamsValue:t.state.optionVal,taskType:"user"},(function(t){0!=t.data.records.length&&(r[e].list.length&&1!=r[e].pageNo?(r[e].list=[].concat((0,i.default)(a.state.optionData[e].list),(0,i.default)(t.data.records)),r[e].pages=t.data.pages):(r[e].list=t.data.records||[],r[e].pages=t.data.pages),a.setState({optionData:r}))}))})),(0,h.default)((0,p.default)(t),"remove",(function(e,a){var n=t.props.form,r=n.getFieldValue("keys");if(1===r.length)return u.default.info("至少保留一个策略!!!");n.setFieldsValue({keys:r.filter((function(t){return t!==e}))});var l=t.state.formSelect;l.splice(a,1),t.setState({formSelect:l})})),(0,h.default)((0,p.default)(t),"add",(function(){var e=t.state,a=e.formSelect,n=e.defaultArray,r=e.optionData,l=e.slevalue;r.push({pageNo:1,list:[]}),a.push(C({andOr:l},n));var o=t.props.form,u=o.getFieldValue("keys").concat(D++);t.setState({formSelect:a}),o.setFieldsValue({keys:u})})),(0,h.default)((0,p.default)(t),"up",(function(e){var a=t.props.form;if(0===e)return u.default.info("已经是排在第一位了,不能移动了!!!");var n=a.getFieldValue("keys");n.splice(e-1,0,n[e]),n.splice(e+1,1),a.setFieldsValue({keys:n});var r=t.state.formSelect;r.splice(e-1,0,r[e]),r.splice(e+1,1),t.setState({formSelect:r})})),(0,h.default)((0,p.default)(t),"down",(function(e){var a=t.props.form,n=a.getFieldValue("keys");if(e===n.length-1)return u.default.info("下面已经没有选项可以移动了!!!");n.splice(e+2,0,n[e]),n.splice(e,1),a.setFieldsValue({keys:n});var r=t.state.formSelect;r.splice(e+2,0,r[e]),r.splice(e,1),t.setState({formSelect:r})})),(0,h.default)((0,p.default)(t),"rulesSubmit",(0,c.default)(s.default.mark((function e(){var a,n,r,l,o;return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=t.state.formSelect,n=[],r=0;r<a.length;r++)n.push((l={andOr:a[r][0],property:a[r][1]},(0,h.default)(l,"property",a[r][2]),(0,h.default)(l,"relation",a[r][3]),(0,h.default)(l,"sort",r),l));o={andOr:"and",list:n,sort:0,template:!0,type:"2",value:"用户规则"},t.props.recommendRuleTemplateSave(o,(function(e){"success"==response.msg?u.default.success("保存成功"):u.default.error("保存失败")}));case 5:case"end":return e.stop()}}),e)})))),t.state={currentClassify:"",relationList:[],initData:[{init:"初始化"}],defaultArray:[],formSelect:[],thirdly:[],userList:[],optionVal:"",optionData:[{pageNo:1,list:[]}],slevalue:"and"},t}return(0,d.default)(n,[{key:"componentDidMount",value:function(){this.queryData()}},{key:"render",value:function(){var e=this,t=this.state,a=t.initData,n=t.relationList,r=t.formSelect,u=t.userList,i=this.props.form,s=i.getFieldDecorator,c=i.getFieldValue;s("keys",{initialValue:a});var f=c("keys"),d=!!this.props.editOrNo&&this.props.editOrNo,p=f.map((function(t,a){var i;if(r.length)return O.default.createElement(R,{className:"rules-from-item-"+a,key:t},O.default.createElement("div",{style:{display:"inline-block",width:100,marginRight:"10px"}},a?O.default.createElement(v.default,{disabled:d,onChange:function(t){return e.onOrAndChange(t,a)},value:r[a].andOr},O.default.createElement(V,{value:"and"},"且"),O.default.createElement(V,{value:"or"},"或")):O.default.createElement(v.default,(i={disabled:d,onChange:function(t){return e.onOrAndChange(t,a)}},(0,h.default)(i,"disabled",!0),(0,h.default)(i,"defaultValue","and"),i),O.default.createElement(V,{value:"and"},"若"))),O.default.createElement(v.default,{disabled:d,defaultValue:r[a].property,onChange:function(t){return e.onSecondChange(t,a)},style:{width:120,marginRight:"10px"}},u&&Object.keys(u).map((function(e){return O.default.createElement(V,{key:e,value:e},u[e])}))),"all"==r[a].property||r[a]&&"org"==r[a].property?"":O.default.createElement(v.default,{disabled:d,style:{width:120,marginRight:"10px"},onChange:function(t){e.onThirdChange(t,a)},defaultValue:e.state.formSelect[a].relation},n&&Object.keys(n).map((function(e){return O.default.createElement(V,{key:e,value:e},n[e])}))),r[a]&&"org"==r[a].property?O.default.createElement(v.default,{disabled:d,style:{width:120,marginRight:"10px"},onChange:function(t){e.onThirdChange(t,a)},defaultValue:e.state.formSelect[a].relation},n&&Object.keys(n).filter((function(e){return"contains"!==e&&"notContains"!==e})).map((function(e){return O.default.createElement(V,{key:e,value:e},n[e])}))):"","equals"==r[a].relation&&"all"!==r[a].property||"notEquals"==r[a].relation&&"all"!==r[a].property?O.default.createElement(v.default,{showSearch:!0,value:r[a].name||"",onChange:function(t,n){return e.onLastChange(t,a,"sel",n)},style:{width:120,marginRight:"10px"},onSearch:function(t){return e.handleLastSearch(t,a)},defaultActiveFirstOption:!1,showArrow:!1,onPopupScroll:function(t){return e.changePopupScroll(t,a)},onFocus:function(t){return e.handleFocus(t,a)},disabled:d},e.state.optionData[a].list.length&&e.state.optionData[a].list.map((function(e,t){return O.default.createElement(V,{key:e.taskId+e.taskFieldValue+t,value:e.taskId+e.taskFieldValue,attr:e.taskId},e.taskFieldValue)}))):"all"==r[a].property?"":O.default.createElement(o.default,{disabled:d,onChange:function(t){return e.onLastChange(t,a,"inp")},value:r[a].value||"",style:{width:120,marginRight:"10px"}}),!d&&O.default.createElement("span",null,O.default.createElement("a",null,O.default.createElement(l.default,{type:"plus",style:{marginRight:"10px",fontSize:"24px",color:"#9a8e8e"},onClick:e.add})),O.default.createElement("a",null,O.default.createElement(l.default,{type:"close",style:{marginRight:"10px",fontSize:"24px",color:"#9a8e8e"},onClick:function(){return e.remove(t,a)}})),O.default.createElement("a",null,O.default.createElement(l.default,{type:"caret-up",style:{marginRight:"10px",fontSize:"24px",color:"#9a8e8e"},onClick:function(){return e.up(a)}})),O.default.createElement("a",null,O.default.createElement(l.default,{type:"caret-down",style:{fontSize:"24px",color:"#9a8e8e"},onClick:function(){return e.down(a)}}))))}));return O.default.createElement("div",null,O.default.createElement(S.default,{className:"rules-from",style:{width:this.props.width||"100%",border:"1px solid #0f8de6",padding:"4%"}},p))}}]),n}(O.Component),K=(0,w.connect)((function(e){return e}),C({},b))(S.default.create()(x));t.default=K},1806:function(e,t,a){"use strict";var n=a(4),r=a(0);a(7),a(44),a(3),a(5),a(43),a(107),a(51),a(9),a(10),a(8),a(20),a(1338),a(34),a(35),a(23),a(229),a(228),a(6),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a(564);var l=r(a(563));a(140);var o=r(a(535));a(537);var u=r(a(536));a(99);var i=r(a(100));a(540);var s=r(a(539)),c=r(a(79));a(61);var f=r(a(62)),d=r(a(238));a(239);var p=r(a(240)),m=r(a(29)),y=r(a(30)),g=r(a(59)),h=r(a(32)),v=r(a(33)),S=r(a(31)),O=r(a(2));a(592);var w=r(a(566));a(554);var b=r(a(550));a(556);var E=r(a(553)),C=n(a(1)),k=n(a(993)),R=a(52),V=n(a(1337)),D=(a(636),r(a(1541))),x=r(a(1807)),K=r(a(1475)),F=r(a(223));function U(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function j(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?U(Object(a),!0).forEach((function(t){(0,O.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):U(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function N(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var P=E.default.Group,T=b.default.Option,z=w.default.RangePicker,I=0,q=function(e){(0,h.default)(n,e);var t,a=(t=n,function(){var e,a=(0,S.default)(t);if(N()){var n=(0,S.default)(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return(0,v.default)(this,e)});function n(e){var t;return(0,m.default)(this,n),t=a.call(this,e),(0,O.default)((0,g.default)(t),"getView",function(){var e=(0,p.default)(d.default.mark((function e(a){return d.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.props.recommendStrategyView({id:a},(function(e){1e3==e.code&&t.setState({formView:e.data},(function(){var e=t.props.form,a=[],n=[],r=[],l=[];t.state.formView.ruleVos.map((function(e,t){if(2==e.type){var o={name:e.name,list:e.list,andOr:e.andOr,downOrUp:!1,template:!!e.template&&e.template,quoteRuleId:e.quoteRuleId?e.quoteRuleId:""};a=a.concat(o),r.push(t)}else{var u={name:e.name,list:e.list,andOr:e.andOr,downOrUp:!1,template:!!e.template&&e.template,quoteRuleId:e.quoteRuleId?e.quoteRuleId:""};n=n.concat(u),l.push(t)}})),a.length&&n.length&&t.setState({formUserSelect:a,formContenSelect:n},(function(){e.setFieldsValue({userKeys:r,contentKeys:l})}))}))}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,O.default)((0,g.default)(t),"remove",(function(e,a,n){var r=t.props.form,l=t.state,o=l.formContenSelect,u=l.formUserSelect;if("contentKeys"==n){var i=r.getFieldValue("contentKeys");if(1===i.length)return f.default.info("至少保留一个策略!!!");o.splice(a,1),t.setState({formContenSelect:o}),r.setFieldsValue({contentKeys:i.filter((function(t){return t!==e}))})}else{var s=r.getFieldValue("userKeys");if(1===s.length)return f.default.info("至少保留一个策略!!!");u.splice(a,1),t.setState({formUserSelect:u}),r.setFieldsValue({userKeys:s.filter((function(t){return t!==e}))})}})),(0,O.default)((0,g.default)(t),"add",(function(e){var a=t.state,n=a.formContenSelect,r=a.formUserSelect,l=a.sleContentValue,o=a.sleUserValue,u=t.props.form;if("contentKeys"==e){var i=u.getFieldValue("contentKeys").concat(I++),s={name:"内容规则",andOr:l,downOrUp:!1,template:!1};n.push(j({},s)),t.setState({formContenSelect:n,andOr:l,downOrUp:!1}),u.setFieldsValue({contentKeys:i})}else{var c=u.getFieldValue("userKeys").concat(I++),f={name:"用户规则",andOr:o,downOrUp:!1,template:!1};r.push(j({},f)),t.setState({formUserSelect:r,andOr:o,downOrUp:!1}),u.setFieldsValue({userKeys:c})}})),(0,O.default)((0,g.default)(t),"up",(function(e,a){var n=t.props.form,r=t.state,l=r.formContenSelect,o=r.formUserSelect;if(0===e)return f.default.info("已经是排在第一位了,不能移动了!!!");if("contentKeys"==a){var u=n.getFieldValue("contentKeys");u.splice(e-1,0,u[e]),u.splice(e+1,1),n.setFieldsValue({contentKeys:u}),l.splice(e-1,0,l[e]),l.splice(e+1,1),t.setState({formContenSelect:l})}else{var i=n.getFieldValue("userKeys");i.splice(e-1,0,i[e]),i.splice(e+1,1),n.setFieldsValue({userKeys:i}),o.splice(e-1,0,o[e]),o.splice(e+1,1),t.setState({formUserSelect:o})}})),(0,O.default)((0,g.default)(t),"down",(function(e,a){var n=t.props.form,r=t.state,l=r.formContenSelect,o=r.formUserSelect;if("contentKeys"==a){var u=n.getFieldValue("contentKeys");if(e===u.length-1)return f.default.info("下面已经没有选项可以移动了!!!");u.splice(e+2,0,u[e]),u.splice(e,1),n.setFieldsValue({contentKeys:u}),l.splice(e+2,0,l[e]),l.splice(e,1),t.setState({formContenSelect:l})}else{var i=n.getFieldValue("userKeys");if(e===i.length-1)return f.default.info("下面已经没有选项可以移动了!!!");i.splice(e+2,0,i[e]),i.splice(e,1),n.setFieldsValue({userKeys:i}),o.splice(e+2,0,o[e]),o.splice(e,1),t.setState({formUserSelect:o})}})),(0,O.default)((0,g.default)(t),"rulesNameChage",(function(e,a,n){var r=t.state,l=r.formContenSelect,o=r.formUserSelect;"contentKeys"==n?(l[a].name=e.target.value,t.setState({formContenSelect:l})):(o[a].name=e.target.value,t.setState({formUserSelect:o}))})),(0,O.default)((0,g.default)(t),"onOrAndChange",(function(e,a,n){var r=t.state,l=r.formContenSelect,o=r.formUserSelect;"contentKeys"==n?(l.filter((function(e,t){return 0!=t})).map((function(t){t.andOr=e})),t.setState({formContenSelect:l,andOr:e,sleContentValue:e})):(o.filter((function(e,t){return 0!=t})).map((function(t){t.andOr=e})),t.setState({formUserSelect:o,andOr:e,sleUserValue:e}))})),(0,O.default)((0,g.default)(t),"downOrUp",(function(e,a){var n=t.state.downOrUp,r=t.state,l=r.formContenSelect,o=r.formUserSelect;"contentKeys"==a?(l[e].downOrUp=!n,t.setState({formContenSelect:l,downOrUp:!n})):(o[e].downOrUp=!n,t.setState({formUserSelect:o,downOrUp:!n}))})),(0,O.default)((0,g.default)(t),"importRulesOpen",(function(e){"contentKeys"===e?t.setState({importContentRulesVis:!0}):t.setState({importUserRulesVis:!0})})),(0,O.default)((0,g.default)(t),"importRulesClose",(function(e){"contentKeys"===e?t.setState({importContentRulesVis:!1}):t.setState({importUserRulesVis:!1})})),(0,O.default)((0,g.default)(t),"onSubmit",(function(){var e=t.state,a=e.formContenSelect,n=e.formUserSelect,r=[],l=[],o={},u=!1;if(a.map((function(e,a){for(var n=t["AddContentRulesiFrom".concat(a)].state.formSelect,l=0;l<n.length;l++)if("all"!==n[l].property&&(!n[l].value||""==n[l].value.trim()))return f.default.error("请填写完整<内容>规则条件"),void(u=!0);r.push({andOr:e.andOr?e.andOr:"and",name:e.name,quoteRuleId:e.quoteRuleId?e.quoteRuleId:"",type:1,template:e.template,list:t["AddContentRulesiFrom".concat(a)].state.formSelect})})),!u&&(n.map((function(e,a){l.push({andOr:e.andOr?e.andOr:"and",name:e.name,quoteRuleId:e.quoteRuleId?e.quoteRuleId:"",type:2,template:e.template,list:t["AddAddUsersRulesFrom".concat(a)].state.formSelect})})),!u)){(r=r.concat(l)).map((function(e,t){e.sort=t+1,e.list.map((function(e,t){e.sort=t+1}))})),o.ruleVos=r;(0,g.default)(t);t.props.form.validateFields((function(e,a){if(!e){if(o.timeType=a.timeType,2==a.timeType){if(!a.durationTime)return f.default.error("请选择自定义时间！！！");o.startTime=(0,F.default)(a.durationTime[0],"YYYY-MM-DD HH:mm:ss").valueOf(),o.endTime=(0,F.default)(a.durationTime[1],"YYYY-MM-DD HH:mm:ss").valueOf()}o.strategyName=a.strategyName;var n=(0,k.getUrlParam)(location.search,"id");o.id=n||"",t.props.recommendStrategySave(o,(function(e){"1000"==e.code?(f.default.success("保存成功"),history.back()):f.default.error(e.subMsg)}))}}))}})),(0,O.default)((0,g.default)(t),"cbGetData",(function(e,a){var n=t.state,r=n.sleContentValue,l=n.sleUserValue;if(a){var o=t.props.form,u=t.state.formContenSelect,i=Object.keys(e),s=Object.values(e);s.map((function(e){e.downOrUp=!1,e.andOr=r}));var f=o.getFieldValue("contentKeys");f=[].concat((0,c.default)(f),(0,c.default)(i)),console.log(u,"formContenSelect"),u=[].concat((0,c.default)(u),(0,c.default)(s)),t.setState({formContenSelect:u},(function(){o.setFieldsValue({contentKeys:f})}))}else{var d=t.props.form,p=t.state.formUserSelect,m=Object.keys(e),y=Object.values(e);y.map((function(e){e.downOrUp=!1,e.andOr=l}));var g=d.getFieldValue("userKeys");g=[].concat((0,c.default)(g),(0,c.default)(m)),p=[].concat((0,c.default)(p),(0,c.default)(y)),t.setState({formUserSelect:p},(function(){d.setFieldsValue({userKeys:g})}))}})),(0,O.default)((0,g.default)(t),"copyFormSelect",(function(e,a){var n=t.state,r=n.sleContentValue,l=n.sleUserValue;if("contentKeys"===a){var o=t["AddContentRulesiFrom".concat(e)].state.formSelect,u={name:t["contentRuleName".concat(e)].state.value,list:o,andOr:r,downOrUp:!1,template:!1},i=t.props.form,s=t.state.formContenSelect,c=i.getFieldValue("contentKeys");s.push(u);var f=c.concat(I++);t.setState({formContenSelect:s},(function(){i.setFieldsValue({contentKeys:f})}))}else{var d=t["AddAddUsersRulesFrom".concat(e)].state.formSelect,p={name:t["userRuleName".concat(e)].state.value,list:d,andOr:l,downOrUp:!1,template:!1},m=t.props.form,y=t.state.formUserSelect,g=m.getFieldValue("userKeys");y.push(p);var h=g.concat(I++);t.setState({formUserSelect:y},(function(){m.setFieldsValue({userKeys:h})}))}})),t.state={initData:[{init:"初始化"}],formContenSelect:[{name:"内容规则",andOr:"and",downOrUp:!1,template:!1}],formUserSelect:[{name:"用户规则",andOr:"and",downOrUp:!1,template:!1}],andOr:"and",downOrUp:!1,importContentRulesVis:!1,importUserRulesVis:!1,formView:{},sleContentValue:"and",sleUserValue:"and"},t}return(0,y.default)(n,[{key:"componentDidMount",value:function(){if(this.props.props.location.search){var e=(0,k.getUrlParam)(this.props.props.location.search,"id");this.getView(e)}}},{key:"render",value:function(){var e=this,t=this.props.form,a=t.getFieldDecorator,n=t.getFieldValue;a("contentKeys",{initialValue:this.state.initData});var r=n("contentKeys");a("userKeys",{initialValue:this.state.initData});var c=n("userKeys"),f=this.state,d=f.formContenSelect,p=f.formUserSelect,m=(f.andOr,f.importContentRulesVis),y=f.importUserRulesVis,g=f.formView,h=r.map((function(t,n){return C.default.createElement(s.default.Item,{className:"rules-from-item-"+n,key:t},n?C.default.createElement(s.default.Item,{style:{display:"inline-block",width:100,marginRight:"10px"}},a("andOr",{})(C.default.createElement("div",null,C.default.createElement(b.default,{value:d[n].andOr?d[n].andOr:"and",onChange:function(t){return e.onOrAndChange(t,n,"contentKeys")}},C.default.createElement(T,{value:"and"},"且"),C.default.createElement(T,{value:"or"},"或"))))):C.default.createElement("span",null,"若"),C.default.createElement(s.default.Item,{style:{margin:0}},C.default.createElement(i.default,{type:d[n]&&d[n].downOrUp?"up":"down",onClick:function(){return e.downOrUp(n,"contentKeys")},style:{marginRight:"10px",fontSize:"24px",color:"#9a8e8e"}}),C.default.createElement(u.default,{disabled:d[n].template,ref:function(t){return e["contentRuleName".concat(n)]=t},defaultValue:d[n].name,onChange:function(t){return e.rulesNameChage(t,n,"contentKeys")},style:{width:"50%",marginRight:"15%"}}),C.default.createElement("a",null,C.default.createElement(i.default,{type:"close",style:{marginRight:"10px",fontSize:"24px",color:"#9a8e8e"},onClick:function(){return e.remove(t,n,"contentKeys")}})),C.default.createElement("a",null,C.default.createElement(i.default,{type:"caret-up",style:{marginRight:"10px",fontSize:"24px",color:"#9a8e8e"},onClick:function(){return e.up(n,"contentKeys")}})),C.default.createElement("a",null,C.default.createElement(i.default,{type:"caret-down",style:{marginRight:"10px",fontSize:"24px",color:"#9a8e8e"},onClick:function(){return e.down(n,"contentKeys")}})),C.default.createElement("a",null,C.default.createElement(i.default,{type:"copy",style:{fontSize:"24px",color:"#9a8e8e"},onClick:function(){return e.copyFormSelect(n,"contentKeys")}}))),C.default.createElement("div",{style:{display:d[n].downOrUp?"none":"block"}},C.default.createElement(D.default,{cacheList:d[n].list?d[n].list:[],width:"87%",max:!0,buildOrNo:d[n].template,editOrNo:d[n].template,wrappedComponentRef:function(t){e["AddContentRulesiFrom".concat(n)]=t}})))}));console.log(p,"回显数据");var v=c.map((function(t,n){var r;return C.default.createElement(s.default.Item,{className:"rules-from-item-"+n,key:t},n?C.default.createElement(s.default.Item,{style:{display:"inline-block",width:100,marginRight:"10px"}},a("andOr",{})(C.default.createElement("div",null,C.default.createElement(b.default,{value:p[n].andOr?p[n].andOr:"and",onChange:function(t){return e.onOrAndChange(t,n,"userKeys")}},C.default.createElement(T,{value:"and"},"且"),C.default.createElement(T,{value:"or"},"或"))))):C.default.createElement("span",null,"若"),C.default.createElement(s.default.Item,{style:{margin:0}},C.default.createElement(i.default,{type:p[n]&&p[n].downOrUp?"up":"down",onClick:function(){return e.downOrUp(n,"usersKeys")},style:{marginRight:"10px",fontSize:"24px",color:"#9a8e8e"}}),C.default.createElement(u.default,(r={disabled:p[n].template,defaultValue:"用户规则",ref:function(t){return e["userRuleName".concat(n)]=t},onChange:function(t){return e.rulesNameChage(t,n)}},(0,O.default)(r,"defaultValue",p[n].name),(0,O.default)(r,"style",{width:"50%",marginRight:"15%"}),r)),C.default.createElement("a",null,C.default.createElement(i.default,{type:"close",style:{marginRight:"10px",fontSize:"24px",color:"#9a8e8e"},onClick:function(){return e.remove(t,n)}})),C.default.createElement("a",null,C.default.createElement(i.default,{type:"caret-up",style:{marginRight:"10px",fontSize:"24px",color:"#9a8e8e"},onClick:function(){return e.up(n)}})),C.default.createElement("a",null,C.default.createElement(i.default,{type:"caret-down",style:{marginRight:"10px",fontSize:"24px",color:"#9a8e8e"},onClick:function(){return e.down(n)}})),C.default.createElement("a",null,C.default.createElement(i.default,{type:"copy",style:{fontSize:"24px",color:"#9a8e8e"},onClick:function(){return e.copyFormSelect(n)}}))),C.default.createElement("div",{style:{display:p[n].downOrUp?"none":"block"}},C.default.createElement(K.default,{cacheList:p[n].list?p[n].list:[],width:"87%",max:!0,editOrNo:p[n].template,wrappedComponentRef:function(t){e["AddAddUsersRulesFrom".concat(n)]=t}})))}));return C.default.createElement(s.default,{labelCol:{span:3},wrapperCol:{span:21},onSubmit:this.handleSubmit},C.default.createElement(s.default.Item,{label:"策略名称",wrapperCol:{span:14}},a("strategyName",{rules:[{required:!0,message:"请输入策略名称!"}],initialValue:g.strategyName?g.strategyName:""})(C.default.createElement(u.default,{placeholder:"输入策略名称（50个字以内）",maxLength:50}))),C.default.createElement(s.default.Item,{label:"策略时段"},a("timeType",{rules:[{required:!0,message:"Please input your note!"}],initialValue:g.timeType?g.timeType:1})(C.default.createElement(P,null,C.default.createElement("div",null,C.default.createElement(E.default,{value:1},"长期有效")),C.default.createElement("div",null,C.default.createElement(E.default,{value:2},"自定义:",C.default.createElement("div",{style:{position:"absolute",left:"116px",top:"-8px",width:"330px"}},C.default.createElement(s.default.Item,{label:""},a("durationTime",{initialValue:g.timeType&&2==g.timeType?[(0,F.default)(g.startTime),(0,F.default)(g.endTime)]:""})(C.default.createElement(z,{disabledDate:k.default.disabledDate,showTime:{format:"HH:mm"},format:"YYYY-MM-DD HH:mm"}))))))))),C.default.createElement(s.default.Item,{label:C.default.createElement("span",null,C.default.createElement("span",{style:{display:"inline-block",color:"#f5222d",fontSize:"14px",lineHeight:1,fontFamily:"SimSun, sans-serif",marginRight:"4px"}}," ","*"," "),"推荐内容"),style:{margin:0}},h,C.default.createElement("div",{style:{marginBottom:"2%"}},C.default.createElement("div",{style:{textAlign:"center"}},C.default.createElement("a",{style:{display:"inline-block",marginRight:"10%"},onClick:function(){return e.add("contentKeys")}},C.default.createElement(i.default,{style:{fontSize:"40px"},type:"plus-circle"}),C.default.createElement("div",null,"新增内容规则")),C.default.createElement("a",{style:{display:"inline-block"},onClick:function(){return e.importRulesOpen("contentKeys")}},C.default.createElement(i.default,{style:{fontSize:"40px"},type:"download"}),C.default.createElement("br",null),C.default.createElement("div",null,"引用内容规则")))),C.default.createElement("div",null,m&&C.default.createElement(x.default,{importRulesClose:this.importRulesClose,importRulesVis:m,cbGetData:this.cbGetData,title:"引用内容规则",fromType:"1",fromContentKeys:"contentKeys"}))),C.default.createElement(s.default.Item,{label:C.default.createElement("span",null,C.default.createElement("span",{style:{display:"inline-block",color:"#f5222d",fontSize:"14px",lineHeight:1,fontFamily:"SimSun, sans-serif",marginRight:"4px"}}," ","*"," "),"推荐用户")},v,C.default.createElement("div",{style:{marginBottom:"2%"}},C.default.createElement("div",{style:{textAlign:"center"}},C.default.createElement("a",{style:{display:"inline-block",marginRight:"10%"},onClick:function(){return e.add("usersKeys")}},C.default.createElement(i.default,{style:{fontSize:"40px"},type:"plus-circle"}),C.default.createElement("div",null,"新增用户规则")),C.default.createElement("a",{style:{display:"inline-block"},onClick:function(){return e.importRulesOpen("usersKeys")}},C.default.createElement(i.default,{style:{fontSize:"40px"},type:"download"}),C.default.createElement("br",null),C.default.createElement("div",null,"引用用户规则")))),C.default.createElement("div",null,y&&C.default.createElement(x.default,{importRulesClose:this.importRulesClose,importRulesVis:y,fromType:"2",title:"引用用户规则",fromContentKeys:"",cbGetData:this.cbGetData}))),C.default.createElement(s.default.Item,{wrapperCol:{span:12,offset:5},style:{textAlign:"center"}},C.default.createElement(o.default,{type:"primary",style:{marginRight:"20px"},onClick:this.onSubmit},"保存"),C.default.createElement(l.default,{onConfirm:function(){history.back()},title:"确定放弃此策略?"},C.default.createElement(o.default,null,"取消"))))}}]),n}(C.Component),A=(0,R.connect)((function(e){return e}),j({},V))(s.default.create()(q));t.default=A},1807:function(e,t,a){"use strict";var n=a(4),r=a(0);a(20),a(34),a(23),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a(224);var l=r(a(225));a(569);var o=r(a(558));a(549);var u=r(a(544));a(140);var i=r(a(535));a(537);var s=r(a(536)),c=r(a(238));a(239);var f=r(a(240)),d=r(a(29)),p=r(a(30)),m=r(a(59)),y=r(a(32)),g=r(a(33)),h=r(a(31)),v=r(a(2));a(540);var S=r(a(539)),O=n(a(1)),w=r(a(223)),b=a(52),E=n(a(1337));function C(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function k(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var R=S.default.Item,V=function(e){(0,y.default)(n,e);var t,a=(t=n,function(){var e,a=(0,h.default)(t);if(k()){var n=(0,h.default)(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return(0,g.default)(this,e)});function n(e){var t;return(0,d.default)(this,n),t=a.call(this,e),(0,v.default)((0,m.default)(t),"columns",[{title:"序号",dataIndex:"id",render:function(e,a,n){return(t.state.pageNo-1)*t.state.pageSize+n+1}},{title:"规则名称",dataIndex:"name",render:function(e){return O.default.createElement("span",{title:e},e.length>10?e.substring(9,0)+"...":e)}},{title:"创建时间",dataIndex:"createTime",render:function(e,t){return O.default.createElement("span",null,(0,w.default)(e).format("YYYY-MM-DD HH:mm:ss"))}}]),(0,v.default)((0,m.default)(t),"queryData",function(){var e=(0,f.default)(c.default.mark((function e(a,n){var r,l,o,u;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(a,"pageNo"),console.log(n,"pageSize"),r=t.props.fromType,l=t.props.form.getFieldValue("ruleName"),o={name:l||"",pageNo:a||t.state.pageNo,pageSize:n||t.state.pageSize,type:r},u=(0,m.default)(t),t.props.recommendRulePage(o,(function(e){u.setState({tableData:e.data,page:e.page,pageNo:a||1,pageSize:n||20}),console.log("666",e)}));case 7:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),(0,v.default)((0,m.default)(t),"onSelectChange",(function(e){console.log("selectedRowKeys changed: ",e),t.setState({selectedRowKeys:e})})),(0,v.default)((0,m.default)(t),"handleSubmit",(function(e){e.preventDefault(),t.setState({pageNo:1},(function(){t.queryData()}))})),(0,v.default)((0,m.default)(t),"importFun",(function(){var e=t.state.selectedRowKeys;t.props.recommendRuleIdsGet(e,(function(e){var a=t.props,n=a.fromContentKeys,r=a.cbGetData;"contentKeys"==n?(r(e.data,"contentKeys"),t.props.importRulesClose("contentKeys")):(t.props.importRulesClose(""),r(e.data,""))}))})),t.state={visible:e.importRulesVis,tableData:[],pageNo:1,pageSize:20,page:{},selectedRowKeys:[]},t}return(0,p.default)(n,[{key:"componentDidMount",value:function(){this.queryData()}},{key:"render",value:function(){var e=this,t=this.state,a=t.tableData,n=t.selectedRowKeys,r=t.page;console.log(r);var c=this.props.form.getFieldDecorator,f={selectedRowKeys:n,onChange:this.onSelectChange};return O.default.createElement(l.default,{title:this.props.title,visible:this.state.visible,onOk:this.handleOk,onCancel:function(){"contentKeys"==e.props.fromContentKeys?e.props.importRulesClose("contentKeys"):e.props.importRulesClose("")},width:"70%",footer:null},O.default.createElement("div",{style:{padding:"2% 2% 0% 2%"}},O.default.createElement("div",{className:"header-rules--search"},O.default.createElement(S.default,{layout:"inline",onSubmit:this.handleSubmit,style:{paddingBottom:30}},O.default.createElement(R,{label:"规则名称："},c("ruleName")(O.default.createElement(s.default,{style:{width:"250px"},placeholder:"请输入规则名称"}))),O.default.createElement(R,null,O.default.createElement(i.default,{type:"primary",htmlType:"submit"},"查询"),O.default.createElement(i.default,{style:{marginLeft:"16px"},onClick:this.importFun,type:"primary"},"引用")))),O.default.createElement(u.default,{rowSelection:f,rowKey:"id",columns:this.columns,dataSource:a,pagination:!1}),O.default.createElement(o.default,{style:{textAlign:"center",marginTop:"20px",marginBottom:"20px"},defaultPageSize:20,current:this.state.pageNo||1,total:this.state.page&&this.state.page.pageTotal,showTotal:function(e){return"共计".concat(e,"条")},onChange:function(t,a){e.queryData(t,a)},onShowSizeChange:function(t,a){e.queryData(t,a)},showSizeChanger:!0,showQuickJumper:!0,pageSizeOptions:["20","50","100"]})))}}]),n}(O.Component),D=(0,b.connect)((function(e){return e}),function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?C(Object(a),!0).forEach((function(t){(0,v.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):C(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},E))(S.default.create({})(V));t.default=D},553:function(e,t,a){e.exports=a(11)(206)},993:function(e,t,a){"use strict";var n=a(0);a(3),a(82),a(101),a(35),a(84),a(53),a(224);var r=n(a(225)),l=n(a(223)),o=r.default.confirm,u={companyCode:location.pathname.split("/")[1],siteCode:location.pathname.split("/")[2],getStatus:function(e,t){switch("string"==typeof t&&(t=parseInt(t)),e){case"homework":return u.homeworkStatus(t);case"readover":return u.readoverStatus(t);case"questionBank":return u.questionBankStatus(t);case"question":return u.questionStatus(t);case"paper":return u.paperStatus(t);case"door":return u.doorStatus(t)}},getType:function(e,t){switch(e){case"question":return u.questionType(t)}},homeworkStatus:function(e){switch(e){case 1:return"草稿";case 2:return"已上架";case 3:return"已下架"}},readoverStatus:function(e){switch(e){case 1:return"待评阅";case 2:return"已阅"}},questionBankStatus:function(e){switch(e){case 0:return"未使用";case 1:return"使用中"}},questionStatus:function(e){return e>0?"使用中":""},questionType:function(e){switch(e){case 1:return"单选题";case 2:return"多选题";case 3:return"判断题";case 4:return"问答题";default:return"一般题"}},paperStatus:function(e){switch(e){case 0:return"待阅卷";case 1:return"已阅卷"}},doorStatus:function(e){switch(e){case 0:return"未发布";case 1:return"已生效"}},paginationConfig:function(e,t){return t?{current:t,defaultCurrent:1,defaultPageSize:20,showTotal:function(e){return"共计 ".concat(e," 条")},pageSizeOptions:["20","50","100"],showQuickJumper:!0,showSizeChanger:!0,onChange:e,onShowSizeChange:e}:{defaultCurrent:1,defaultPageSize:20,showTotal:function(e){return"共计 ".concat(e," 条")},pageSizeOptions:["20","50","100"],showQuickJumper:!0,showSizeChanger:!0,onChange:e,onShowSizeChange:e}},formateTime:function(e){var t="";if(e){var a=new Date(parseInt(e));t+=a.getFullYear()+"-"+u.double(a.getMonth()+1)+"-"+u.double(a.getDate())+" "+u.double(a.getHours())+":"+u.double(a.getMinutes())}return t},formateTimeForJingxuan:function(e){var t="";if(e){var a=new Date(parseInt(e));t+=a.getFullYear()+"-"+u.double(a.getMonth()+1)+"-"+u.double(a.getDate())+" "+u.double(a.getHours())+":"+u.double(a.getMinutes())+":"+u.double(a.getSeconds())}return t},double:function(e){return e>=10?e:"0"+e},confirm:function(e,t){o({title:e,content:"",onOk:function(){t&&t()},onCancel:function(){}})},getUrlParam:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,a=[],n="";if(e.length>0){a=-1==e.indexOf("&&")?e.split("?")[1].split("&"):e.split("?")[1].split("&&");for(var r=0;r<a.length;r++)if(-1!=a[r].indexOf(t+"=")){n=a[r].split("=")[1];break}}return n},treeDataFormate:function(e){var t=[];t=e.filter((function(e,t){return"0"==e.parentId}));for(var a=function(a){if((r=e.filter((function(e,n){return e.parentId==t[a].id}))).length>0){for(var n=0;n<r.length;n++)r[n].key=a+1+"-"+(n+1),r[n].code=a+1+"-"+(n+1),r[n].dkeys=a+1;t[a].children=r}t[a].key=a+1,t[a].code=a+1},n=0;n<t.length;n++){var r;a(n)}return t},getRouterBefore:function(){var e=location.pathname;return"/"+e.split("/")[1]+"/"+e.split("/")[2]},getRouterDetail:function(){var e=location.pathname;return"/"+e.split("/")[3]+"/"+e.split("/")[4]},quitLogin:function(e){Storage.sessionRemove("token"),setTimeout((function(){e&&e()}),500)},getWechatOrigin:function(e){return e.includes("dev.mg.kme")?e.split("://")[0]+"://dev.wechat.kmelearning.com":e.includes("test.mg.kme")?e.split("://")[0]+"://test.wechat.kmelearning.com":e.includes("uat.mg.kme")?e.split("://")[0]+"://uat.wechat.kmelearning.com":e.includes("//mg.kme")?e.split("://")[0]+"://wechat.kmelearning.com":void 0},disabledDate:function(e){return e&&e<(0,l.default)().endOf("day").subtract(1,"days")},secondToFormat:function(e){var t=0,a=0,n=0;return e>=0?(n=e%60,e>=60&&(a=(e-n)/60%60),e>=3600&&(t=(e-n-60*a)/60/60),u.doubleNum(t,a,n)):"00:00:00"},doubleNum:function(e,t,a){return e<10&&(e="0"+e),t<10&&(t="0"+t),a<10&&(a="0"+a),e+":"+t+":"+a},getRandomStr:function(e,t){for(var a="",n=0;n<e;n++)1==Math.floor(2*Math.random())?a+="0123456789"[Math.floor(10*Math.random())]:a+="abcdefghijklmnopqrstuvwxyz"[Math.floor(26*Math.random())];return t?a:a+(new Date).getTime()}};e.exports=u}}]);