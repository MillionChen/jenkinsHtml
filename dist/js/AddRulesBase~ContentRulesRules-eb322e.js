(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{1337:function(e,t,a){"use strict";var n=a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.recommendStrategyCopy=function(e,t){return function(a){return(0,r.default)({url:l,data:e}).then((function(e){t&&t(e)}))}},t.recommendStrategyDelete=function(e,t){return function(a){return(0,r.default)({url:u,data:e}).then((function(e){t&&t(e)}))}},t.recommendStrategyPage=function(e,t){return function(a){return(0,r.default)({url:s,data:e}).then((function(e){t&&t(e)}))}},t.recommendRulePage=function(e,t){return function(a){return(0,r.default)({url:i,data:e}).then((function(e){t&&t(e)}))}},t.recommendRuleIdsGet=function(e,t){return function(a){return(0,r.default)({url:c,data:e}).then((function(e){t&&t(e)}))}},t.recommendStrategyView=function(e,t){return function(a){return(0,r.default)({url:f,data:e}).then((function(e){t&&t(e)}))}},t.recommendStrategySave=function(e,t){return function(a){return(0,r.default)({url:d,data:e}).then((function(e){t&&t(e)}))}},t.rulesGetInitJson=function(e){return function(t){return(0,r.default)({url:p}).then((function(t){e&&e(t)}))}},t.recommendStrategyDrools=function(e,t){return function(a){return(0,r.default)({url:m,data:e}).then((function(e){t&&t(e)}))}},t.recommendRuleTemplateSave=function(e,t){return function(a){return(0,r.default)({url:g,data:e}).then((function(e){t&&t(e)}))}};var r=n(a(78)),o=n(a(1414)),l=o.default.recommendStrategyCopyApi,u=o.default.recommendStrategyDeleteApi,s=o.default.recommendStrategyPageApi,i=o.default.recommendRulePageApi,c=o.default.recommendRuleIdsGetApi,f=o.default.recommendStrategyViewApi,d=o.default.recommendStrategySaveApi,p=o.default.rulesGetInitJsonApi,m=o.default.recommendStrategyDroolsApi,g=o.default.recommendRuleTemplateSaveApi},1414:function(e,t,a){"use strict";var n=a(0);a(44),Object.defineProperty(t,"__esModule",{value:!0}),t.recommendRuleTemplateSave=function(e){return post("/rules/manage/recommendRule/template/save?companyCode=".concat(companyCode,"&siteCode=").concat(siteCode),e)},t.default=void 0;var r=n(a(63)),o={recommendStrategyCopyApi:"POST ".concat(r.default.base,"/rules/manage/recommendStrategy/copy"),recommendStrategyDeleteApi:"POST ".concat(r.default.base,"/rules/manage/recommendStrategy/delete"),recommendStrategyPageApi:"GET ".concat(r.default.base,"/rules/manage/recommendStrategy/page"),recommendRulePageApi:"GET ".concat(r.default.base,"/rules/manage/recommendRule/page"),recommendRuleIdsGetApi:"POST ".concat(r.default.base,"/rules/manage/recommendRule/ids/get"),recommendStrategyViewApi:"GET ".concat(r.default.base,"/rules/manage/recommendStrategy/view"),recommendStrategySaveApi:"POST ".concat(r.default.base,"/rules/manage/recommendStrategy/save"),rulesGetInitJsonApi:"GET ".concat(r.default.base,"/rules/manage/recommendRule/getJson"),recommendStrategyDroolsApi:"POST ".concat(r.default.base,"/web-manage/drools/manage/task/page"),recommendRuleTemplateSaveApi:"POST ".concat(r.default.base,"/rules/manage/recommendRule/template/save")};t.default=o},1541:function(e,t,a){"use strict";var n=a(4),r=a(0);a(7),a(44),a(3),a(5),a(40),a(107),a(51),a(9),a(10),a(8),a(20),a(34),a(23),a(6),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a(99);var o=r(a(100));a(537);var l=r(a(536));a(61);var u=r(a(62)),s=r(a(81)),i=r(a(238));a(239);var c=r(a(240)),f=r(a(29)),d=r(a(30)),p=r(a(59)),m=r(a(32)),g=r(a(33)),y=r(a(31)),h=r(a(2));a(554);var S=r(a(550));a(540);var v=r(a(539)),b=n(a(1)),D=a(52),O=n(a(1337));function k(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function C(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?k(Object(a),!0).forEach((function(t){(0,h.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):k(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function E(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var w=v.default.Item,P=S.default.Option,A=0,R=function(e){(0,m.default)(n,e);var t,a=(t=n,function(){var e,a=(0,y.default)(t);if(E()){var n=(0,y.default)(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return(0,g.default)(this,e)});function n(e){var t;return(0,f.default)(this,n),t=a.call(this,e),(0,h.default)((0,p.default)(t),"queryData",(0,c.default)(i.default.mark((function e(){var a;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.state.optionData,t.props.rulesGetInitJson((function(e){if(1e3==e.code&&e.data){var n=Object.keys(e.data.business),r=t.state.defaultArray,o=Object.keys(e.data.property[n[0]]),l=Object.keys(e.data.relation);r={business:n[0],property:o[0],relation:l[0]};var u=t.props.cacheList,s=void 0===u?[]:u;if(s.length){for(var i=[],c=t.props.form,f=c.getFieldValue("keys"),d=0;d<s.length;d++)i.push(s[d]),0!=d&&(f.push(A++),a.push({pageNo:1,list:[]}));t.setState({classifyList:e.data.business,propertyList:e.data.property,relationList:e.data.relation,formSelect:i,currentClassify:n[0],fList:n,defaultArray:r,optionData:a});var p=f;c.setFieldsValue({keys:p})}else t.setState({classifyList:e.data.business,propertyList:e.data.property,relationList:e.data.relation,formSelect:[C({andOr:"and"},r)],currentClassify:n[0],fList:n,defaultArray:r})}}));case 2:case"end":return e.stop()}}),e)})))),(0,h.default)((0,p.default)(t),"handleProvinceChange",(function(e,a){var n=(0,p.default)(t),r=t.state,o=r.formSelect,l=r.optionData;l[a]={pageNo:1,list:[]},o[a].business=e,o[a].property="all","equals"==o[a].relation||"notEquals"==o[a].relation?(o[a].value="",o[a].name="",t.setState({formSelect:o,optionData:l},(function(){n.changeOptionsData(a)}))):t.setState({formSelect:o,optionData:l});var u=t.state.currentClassify;t.setState({currentClassify:u})})),(0,h.default)((0,p.default)(t),"onSecondCityChange",(function(e,a){var n=(0,p.default)(t),r=t.state,o=r.formSelect,l=r.optionData;l[a]={pageNo:1,list:[]},o[a].property=e,"all"==e?(o[a].relation="",o[a].value="",o[a].name="",t.setState({formSelect:o})):"equals"==o[a].relation||"notEquals"==o[a].relation?(o[a].value="",o[a].name="",t.setState({formSelect:o,optionData:l},(function(){n.changeOptionsData(a)}))):t.setState({formSelect:o,optionData:l})})),(0,h.default)((0,p.default)(t),"onOrAndChange",(function(e,a){var n=t.state.formSelect;n.filter((function(e,t){return 0!=t})).map((function(t){t.andOr=e})),t.setState({formSelect:n,slevalue:e})})),(0,h.default)((0,p.default)(t),"onThirdChange",(function(e,a){var n=t.state.formSelect,r=(0,p.default)(t);n[a].relation=e,"equals"!=n[a].relation&&"notEquals"!=n[a].relation||(n[a].value="",n[a].name=""),t.setState({formSelect:n},(function(){if("notEquals"==e||"equals"==e){var n=t.state.optionData;n[a]={pageNo:1,list:[]},r.setState({optionData:n},(function(){r.changeOptionsData(a)}))}}))})),(0,h.default)((0,p.default)(t),"onLastChange",(function(e,a,n,r){var o=t.state.formSelect;if("sel"==n){var l=r.props.attr;o[a].value=l,o[a].name=r.props.children}else o[a].value=e.target.value,o[a].name="";t.setState({formSelect:o})})),(0,h.default)((0,p.default)(t),"handleLastSearch",(function(e,a){var n=t.state.optionData;n[a]={pageNo:1,list:[]},t.setState({optionData:n,optionVal:e},(function(){t.changeOptionsData(a,e)}))})),(0,h.default)((0,p.default)(t),"handleFocus",(function(e,a){t.state.formSelect;var n=t.state.optionData;n[a]={pageNo:1,list:[]},t.setState({optionVal:"",optionData:n},(function(){t.changeOptionsData(a)}))})),(0,h.default)((0,p.default)(t),"changePopupScroll",(function(e,a){var n=t.state.optionData;n[a].pages&&n[a].pageNo==n[a].pages||e.target.scrollTop>=e.target.scrollHeight-e.target.offsetHeight-10&&(n[a].pageNo=n[a].pageNo+1,t.setState({optionData:n},(function(){t.changeOptionsData(a)})))})),(0,h.default)((0,p.default)(t),"changeOptionsData",(function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var a=(0,p.default)(t),n=t.state,r=n.formSelect,o=n.optionVal,l=t.state.optionData,u={pageNo:t.state.optionData[e].pageNo,pageSize:t.state.pageSize,taskParamsType:r[e].property,taskParamsValue:o,taskType:r[e].business};t.props.recommendStrategyDrools(u,(function(t){0!=t.data.records.length&&(l[e].list.length&&1!=l[e].pageNo?(l[e].list=[].concat((0,s.default)(a.state.optionData[e].list),(0,s.default)(t.data.records)),l[e].pages=t.data.pages):(l[e].list=t.data.records||[],l[e].pages=t.data.pages),a.setState({optionData:l}))}))})),(0,h.default)((0,p.default)(t),"remove",(function(e,a){var n=t.props.form,r=n.getFieldValue("keys");if(1===r.length)return u.default.info("至少保留一个策略!!!");n.setFieldsValue({keys:r.filter((function(t){return t!==e}))});var o=t.state,l=o.formSelect,s=o.optionData;l.splice(a,1),s.splice(a,1),t.setState({formSelect:l,optionData:s})})),(0,h.default)((0,p.default)(t),"add",(function(){var e=t.state,a=e.formSelect,n=e.defaultArray,r=e.optionData,o=e.slevalue;a.push(C({andOr:o,value:""},n)),r.push({pageNo:1,list:[]});var l=t.props.form,u=l.getFieldValue("keys").concat(A++);t.setState({formSelect:a,optionData:r}),l.setFieldsValue({keys:u})})),(0,h.default)((0,p.default)(t),"up",(function(e){var a=t.props.form;if(0===e)return u.default.info("已经是排在第一位了,不能移动了!!!");var n=a.getFieldValue("keys");n.splice(e-1,0,n[e]),n.splice(e+1,1),a.setFieldsValue({keys:n});var r=t.state,o=r.formSelect,l=r.optionData;o.splice(e-1,0,o[e]),o.splice(e+1,1),l.splice(e-1,0,l[e]),l.splice(e+1,1),t.setState({formSelect:o,optionData:l})})),(0,h.default)((0,p.default)(t),"down",(function(e){var a=t.props.form,n=a.getFieldValue("keys");if(e===n.length-1)return u.default.info("下面已经没有选项可以移动了!!!");n.splice(e+2,0,n[e]),n.splice(e,1),a.setFieldsValue({keys:n});var r=t.state,o=r.formSelect,l=r.optionData;o.splice(e+2,0,o[e]),o.splice(e,1),l.splice(e+2,0,l[e]),l.splice(e,1),t.setState({formSelect:o,optionData:l})})),(0,h.default)((0,p.default)(t),"rulesSubmit",(0,c.default)(i.default.mark((function e(){var a,n,r,o,l;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=t.state.formSelect,n=[],r=0;r<a.length;r++)o=a[r],a[r]=C({sort:r},o);l={andOr:"and",list:n,sort:0,template:!0,type:1},t.props.recommendRuleTemplateSave(l,(function(e){"success"==e.msg?u.default.success("保存成功"):u.default.error("保存失败")}));case 5:case"end":return e.stop()}}),e)})))),t.state={currentClassify:"",classifyList:[],propertyList:[],relationList:[],totalList:[],fList:[],initData:[{init:"初始化"}],defaultArray:{},formSelect:[],thirdly:[],pageNo:1,pageSize:10,optionData:[{pageNo:1,list:[]}],optionVal:"",slevalue:"and"},t}return(0,d.default)(n,[{key:"componentDidMount",value:function(){this.queryData()}},{key:"render",value:function(){var e=this,t=this.state,a=t.initData,n=t.classifyList,r=t.currentClassify,u=t.fList,s=t.relationList,i=t.propertyList,c=t.formSelect,f=this.props.form,d=f.getFieldDecorator,p=f.getFieldValue,m=!!this.props.editOrNo&&this.props.editOrNo,g=!this.props.cacheList||!this.props.cacheList.length;d("keys",{initialValue:a});var y=p("keys").map((function(t,a){if(c.length)return b.default.createElement(w,{className:"rules-from-item-"+a,key:t},b.default.createElement("div",{style:{display:"inline-block",width:100,marginRight:"10px"}},a?b.default.createElement(S.default,{className:"select-tang1",onChange:function(t){return e.onOrAndChange(t,a)},disabled:m,value:c[a].andOr},b.default.createElement(P,{value:"and"},"且"),b.default.createElement(P,{value:"or"},"或")):b.default.createElement(S.default,{className:"select-tang2",onChange:function(t){return e.onOrAndChange(t,a)},disabled:!0,defaultValue:"and"},b.default.createElement(P,{value:"and"},"若"))),b.default.createElement(S.default,{className:"select-tang3",disabled:m,defaultValue:g?r:c[a].business,style:{width:120,marginRight:"10px"},onChange:function(t){return e.handleProvinceChange(t,a)},key:t},u.map((function(e){return b.default.createElement(P,{key:e},n[e])}))),b.default.createElement(S.default,{className:"select-tang4",disabled:m,style:{width:120,marginRight:"10px"},defaultValue:g?Object.keys(i[c[a].business])[0]:c[a].property,onChange:function(t){return e.onSecondCityChange(t,a)},value:c[a].property&&c[a].property},i[c[a].business]&&Object.keys(i[c[a].business]).map((function(e){return b.default.createElement(P,{key:e,value:e},i[c[a].business][e])}))),"all"!=c[a].property&&b.default.createElement(S.default,{className:"select-tang5",style:{width:120,marginRight:"10px"},disabled:m,onChange:function(t){e.onThirdChange(t,a)},defaultValue:c[a].relation},s&&Object.keys(s).map((function(e){return b.default.createElement(P,{key:e,value:e},s[e])}))),"equals"==c[a].relation||"notEquals"==c[a].relation?"all"!=c[a].property&&b.default.createElement(S.default,{showSearch:!0,disabled:m,className:"select-tang6",value:c[a].name||"",onChange:function(t,n){return e.onLastChange(t,a,"sel",n)},onSearch:function(t){return e.handleLastSearch(t,a)},style:{width:120,marginRight:"10px"},defaultActiveFirstOption:!1,showArrow:!1,onPopupScroll:function(t){return e.changePopupScroll(t,a)},onFocus:function(t){return e.handleFocus(t,a)}},e.state.optionData[a].list.length&&e.state.optionData[a].list.map((function(e,t){return b.default.createElement(P,{key:e.taskId,value:e.taskFieldValue+e.taskId,name:e.taskFieldValue,attr:e.taskId},e.taskFieldValue)}))):"all"!=c[a].property&&b.default.createElement(l.default,{disabled:m,defaultValue:g?"":c[a].value,onChange:function(t){return e.onLastChange(t,a,"inp")},style:{width:120,marginRight:"10px"}}),!m&&b.default.createElement("span",null,b.default.createElement("a",null,b.default.createElement(o.default,{type:"plus",style:{marginRight:"10px",fontSize:"24px",color:"#9a8e8e"},onClick:e.add})),b.default.createElement("a",null,b.default.createElement(o.default,{type:"close",style:{marginRight:"10px",fontSize:"24px",color:"#9a8e8e"},onClick:function(){return e.remove(t,a)}})),b.default.createElement("a",null,b.default.createElement(o.default,{type:"caret-up",style:{marginRight:"10px",fontSize:"24px",color:"#9a8e8e"},onClick:function(){return e.up(a)}})),b.default.createElement("a",null,b.default.createElement(o.default,{type:"caret-down",style:{fontSize:"24px",color:"#9a8e8e"},onClick:function(){return e.down(a)}}))))}));return b.default.createElement("div",null,b.default.createElement(v.default,{className:"rules-from",style:{width:this.props.width||"80%",border:"1px solid #0f8de6",padding:"4% 0 4% 4%"}},y))}}]),n}(b.Component),V=(0,D.connect)((function(e){return e}),C({},O))(v.default.create()(R));t.default=V},535:function(e,t,a){e.exports=a(11)(70)},536:function(e,t,a){e.exports=a(11)(166)},539:function(e,t,a){e.exports=a(11)(821)},540:function(e,t,a){"use strict";a.r(t);a(26),a(577),a(584)},544:function(e,t,a){e.exports=a(11)(846)},550:function(e,t,a){e.exports=a(11)(94)},558:function(e,t,a){e.exports=a(11)(251)},563:function(e,t,a){e.exports=a(11)(837)},564:function(e,t,a){"use strict";a.r(t);a(26),a(581),a(140)},566:function(e,t,a){e.exports=a(11)(817)},577:function(e,t,a){},581:function(e,t,a){"use strict";a.r(t);a(26),a(585)},585:function(e,t,a){},636:function(e,t,a){e.exports=a(46)(174)}}]);